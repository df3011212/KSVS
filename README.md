# 📊 Coinglass Heatmap 分析工具 - 網頁版

這是一個基於網頁的加密貨幣支撐阻力分析工具，從 Node.js 版本轉換而來，提供實時的 Coinglass Heatmap 數據分析和 AI 建議。

## ✨ 功能特色

- 🔍 **實時數據分析**: 獲取最新的 Coinglass Heatmap 數據
- 📈 **支撐阻力識別**: 自動識別關鍵支撐和阻力位
- 🤖 **AI 交易建議**: 根據技術分析提供進場建議
- 🎯 **風險管理**: 計算止盈止損和 RR 倍數
- 📊 **即時掛單量**: 顯示期貨合約買賣盤深度，包含價格、數量和累積量
- 🚨 **OVB 拋售偵測**: 基於掛單量不平衡的 OVB + EMA21 指標，自動偵測大量拋售
- 🔄 **自動更新**: 掛單量數據自動更新，可設定 5秒-1分鐘間隔
- 📈 **狀態指示**: 即時顯示更新狀態和最後更新時間
- 📱 **響應式設計**: 支援桌面和行動裝置
- ⚡ **即時更新**: 支援 4 小時圖和 24 小時圖
- 🎨 **視覺化顯示**: 掛單量熱力圖和統計數據

## 🚀 快速開始

### 方法一：在線使用（GitHub Pages）

**直接訪問您的 GitHub Pages 網站：**
1. 上傳所有檔案到 GitHub 儲存庫
2. 在儲存庫設定中啟用 GitHub Pages
3. 選擇 `main` 分支和 `/ (root)` 目錄
4. 訪問 `https://您的用戶名.github.io/儲存庫名稱`

**GitHub Pages 設定步驟：**
1. 進入 GitHub 儲存庫的 **Settings** 頁面
2. 向下捲動到 **Pages** 部分
3. 在 **Source** 選擇 **Deploy from a branch**
4. 選擇 **main** 分支和 **/ (root)** 資料夾
5. 點擊 **Save** 並等待部署完成

**🔧 GitHub Pages 注意事項：**
- 由於 CORS 限制，某些 API 調用可能失敗
- 程序會自動切換到模擬數據模式
- 所有可視化功能仍可正常使用
- 建議搭配本地使用以獲得完整功能

**⚡ 自動部署（已設定）：**
- 項目已配置 GitHub Actions 自動部署
- 每次推送到 `main` 分支時自動更新網站
- 無需手動設定，推送代碼即可自動部署

### 方法二：本地使用（推薦，完整功能）

1. 下載所有檔案到同一資料夾
2. 使用現代瀏覽器開啟 `index.html`
3. 選擇時間間隔和交易對
4. 點擊「開始分析」

### 方法三：本地伺服器

```bash
# 使用 Python 啟動簡單伺服器
python -m http.server 8000

# 或使用 Node.js
npx http-server
```

然後在瀏覽器中訪問 `http://localhost:8000`

## 📁 檔案結構

```
測試/
├── index.html          # 主頁面
├── style.css           # 樣式檔案
├── script.js           # 主要邏輯
├── README.md           # 說明文件
└── proxy-server.js     # CORS 代理伺服器（可選）
```

## 🔧 技術實現

### 核心功能

- **數據源**: Coinglass API (期貨合約數據) + Binance API (現貨價格)
- **分析算法**: 支撐阻力熱區識別
- **AI 建議**: 基於價格位置和 RR 比計算
- **時間支援**: 4 小時圖和 24 小時圖
- **重要說明**: 掛單量為期貨合約數據，與現貨市場可能存在差異

### 與原版差異

| 功能 | Node.js 版本 | 網頁版本 |
|------|-------------|----------|
| 截圖功能 | ✅ Puppeteer | ❌ 瀏覽器限制 |
| Telegram 推送 | ✅ | ❌ 改為網頁顯示 |
| 排程執行 | ✅ Cron | ❌ 手動觸發 |
| 數據分析 | ✅ | ✅ 完全保留 |
| AI 建議 | ✅ | ✅ 完全保留 |
| 即時掛單量 | ❌ | ✅ 新增功能 |
| 自動更新 | ❌ | ✅ 新增功能 |
| 視覺化界面 | ❌ | ✅ 新增功能 |
| OVB 拋售偵測 | ❌ | ✅ 新增功能 |

### 新增功能詳細說明

#### 📊 即時掛單量 (期貨合約)
- **買賣盤顯示**: 同時顯示期貨合約買單(Bids)和賣單(Asks)
- **分頁瀏覽**: 支援分頁瀏覽所有掛單數據，每頁可顯示 10/15/20 檔
- **靈活排序**: 支援按價格排序或按掛單數量排序（高至低/低至高）
- **視覺化熱力圖**: 根據掛單量大小顯示不同深度的背景色
- **累積量計算**: 顯示每個價位的累積掛單量
- **統計數據**: 提供買賣單總量、平均大小和買賣比例
- **數據來源**: 來自 Coinglass 期貨合約數據，與現貨市場有所差異

#### 🔍 掛單量分析指標
1. **買賣比例**: 
   - \> 1.5: 買盤較強，可能上漲
   - 0.7-1.5: 買賣平衡
   - < 0.7: 賣壓較重，可能下跌

2. **掛單分佈**:
   - 大單集中: 關鍵支撐/阻力位
   - 分散掛單: 較弱的支撐/阻力
   - 掛單空洞: 可能快速通過的價位

3. **實時更新**: 
   - 可即時切換顯示/隱藏掛單量
   - 可調整深度而無需重新分析
   - 自動更新功能，可設定 5秒-1分鐘間隔
   - 狀態指示器顯示更新狀態和最後更新時間

#### 🔄 自動更新系統
- **智能更新**: 只更新掛單量數據，不重新分析技術指標
- **可控間隔**: 支援 5秒、10秒、30秒、1分鐘更新間隔
- **狀態監控**: 實時顯示更新狀態（正常/更新中/錯誤）
- **效能優化**: 避免頻繁API調用，減少伺服器負擔
- **自動停止**: 頁面關閉時自動停止更新定時器

#### 🚨 OVB 拋售偵測系統
- **修正版 OVB 指標**: 基於期貨合約掛單量不平衡計算，適合掛單量分析
- **EMA21 平滑處理**: 使用21期指數移動平均線減少訊號噪音
- **拋售強度評估**: 提供 0-100% 的拋售強度評分
- **多維度分析**: 綜合考慮買賣壓力、OVB趨勢、價格動向
- **自動警報**: 當拋售強度超過 70% 時自動發出警報
- **趨勢狀態顯示**: 看漲/看跌/中性三種趨勢狀態
- **即時監控**: 配合自動更新功能，實時監控拋售壓力變化

## 🎯 使用說明

### 1. 選擇參數
- **時間間隔**: 選擇 4 小時圖或 24 小時圖
- **交易對**: 選擇全部、BTCUSDT 或 ETHUSDT
- **顯示掛單量**: 勾選可查看即時期貨合約買賣盤深度
- **每頁顯示**: 選擇每頁顯示 10/15/20 檔掛單
- **排序方式**: 按價格排序或按掛單數量排序（高至低/低至高）
- **OVB 拋售偵測**: 勾選可啟用 OVB + EMA21 拋售偵測功能
- **自動更新**: 勾選可啟用掛單量自動更新
- **更新間隔**: 設定自動更新間隔（5秒/10秒/30秒/1分鐘）

### 2. 開始分析
點擊「🔍 開始分析」按鈕，系統將：
- 獲取最新價格數據
- 分析 Heatmap 數據
- 識別支撐阻力位
- 處理掛單量數據
- 生成 AI 交易建議

### 3. 解讀結果
- **關鍵阻力區**: 可能遇到賣壓的價位
- **關鍵支撐區**: 可能獲得買盤支撐的價位
- **AI 建議**: 根據當前價格位置提供操作建議
- **即時掛單量 (期貨合約)**: 
  - 🔴 **賣單**: 顯示期貨合約賣壓分佈，價格越高顏色越深
  - 🟢 **買單**: 顯示期貨合約買盤支撐，數量越大顏色越深
  - 📊 **統計數據**: 期貨合約買賣單總量、平均大小和買賣比例
  - 💰 **當前價格**: 實時現貨市場價格顯示
  - 🔄 **自動更新**: 可設定 5秒-1分鐘間隔自動刷新數據
  - 📈 **狀態指示**: 綠燈正常，黃燈更新中，紅燈錯誤
  - ⚠️ **重要提醒**: 掛單量為期貨合約數據，與現貨市場存在差異
- **OVB 拋售偵測 (若啟用)**:
  - 🚨 **拋售警報**: 當偵測到大量拋售時會顯示紅色警報
  - 📊 **OVB 值**: 正值表示累積買盤，負值表示累積賣盤
  - 📈 **EMA21**: OVB 的21期指數移動平均線，用於判斷趨勢
  - 🔥 **拋售強度**: 0-100%，超過70%會觸發警報
  - 💪 **買賣壓力**: 顯示當前買盤和賣盤的壓力比例
  - 🎯 **趨勢狀態**: 看漲(綠色)/看跌(紅色)/中性(灰色)

## ⚠️ 重要提醒

### CORS 限制
由於瀏覽器的同源政策限制，某些 API 調用可能會失敗。解決方案：

1. **使用 CORS 代理** (已內建)
2. **本地代理伺服器** (見下方說明)
3. **瀏覽器插件** (如 CORS Unblock)

### 免責聲明
- 📊 本工具僅供技術分析參考
- ⚠️ 投資有風險，請自行承擔投資風險
- 🔍 建議結合其他指標和基本面分析
- 💰 請勿將全部資金投入單一交易
- 🏦 **數據來源說明**: 掛單量為期貨合約數據，與現貨市場存在差異，請注意區分

## 🛠️ CORS 代理伺服器（可選）

如果遇到 CORS 問題，可以使用本地代理伺服器：

```javascript
// proxy-server.js
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware');
const cors = require('cors');

const app = express();
app.use(cors());

app.use('/api', createProxyMiddleware({
  target: 'https://capi.coinglass.com',
  changeOrigin: true,
  pathRewrite: {
    '^/api': '',
  },
}));

app.listen(3001, () => {
  console.log('代理伺服器運行在 http://localhost:3001');
});
```

安裝依賴並執行：
```bash
npm install express http-proxy-middleware cors
node proxy-server.js
```

然後修改 `script.js` 中的 API_BASE：
```javascript
const API_BASE = 'http://localhost:3001/api/liquidity-heatmap/api/liquidity/v4/heatmap';
```

## 🎨 自訂化

### 修改交易對
在 `script.js` 中修改 `PAIRS` 陣列：
```javascript
const PAIRS = [
    { name: 'BTCUSDT', symbol: 'Binance_BTCUSDT#heatmap', tab: 'Binance BTCUSDT' },
    { name: 'ETHUSDT', symbol: 'Binance_ETHUSDT#heatmap', tab: 'Binance ETHUSDT' },
    // 新增其他交易對...
];
```

### 調整 AI 參數
修改 `getAISuggestion` 函數中的參數：
```javascript
const step = pair.startsWith('BTC') ? 30 : 15;  // 調整步長
const near = step * 5;                          // 調整觸發距離
```

### 自訂掛單量顯示
修改 `processOrderBookData` 函數來調整掛單量處理：
```javascript
// 調整過濾條件 - 只顯示大於平均值3倍的掛單
.filter(([, s]) => s >= avg * 3)

// 修改格式化函數來改變單位顯示
function formatSize(size) {
    if (size >= 1000000) return (size / 1000000).toFixed(2) + 'M';
    if (size >= 1000) return (size / 1000).toFixed(2) + 'K';
    return size.toFixed(4);
}
```

## 💡 使用技巧

### 掛單量分析技巧
1. **大單警示**: 注意單筆掛單量特別大的價位
2. **掛單密集區**: 多個大單集中的價位通常是強力支撐/阻力
3. **掛單稀疏區**: 掛單稀少的價位可能被快速突破
4. **買賣比例**: 結合買賣比例判斷市場情緒
5. **動態觀察**: 可切換不同排序方式和分頁深度觀察掛單分佈變化

### 分頁和排序使用技巧
1. **按價格排序**: 
   - 最接近市價的掛單，觀察短期支撐阻力
   - 適合查看即將成交的掛單分佈

2. **按數量排序（高至低）**: 
   - 快速找到大單集中的價位
   - 識別主力掛單和關鍵支撐阻力位

3. **按數量排序（低至高）**: 
   - 查看小額掛單分佈
   - 識別散戶行為和市場參與度

4. **分頁瀏覽**: 
   - 第1頁：最接近市價或最大掛單
   - 後續頁：更深層次的支撐阻力位
   - 可設定每頁顯示數量適應不同分析需求

### 自動更新使用建議
1. **適當間隔**: 
   - 短線交易：選擇 5-10 秒間隔
   - 波段交易：選擇 30 秒-1 分鐘間隔
   - 長線觀察：手動更新即可

2. **效能考量**: 
   - 同時監控多個交易對時建議用較長間隔
   - 網路較慢時避免使用過短間隔
   - 注意API使用限制

3. **狀態監控**: 
   - 🟢 綠燈：數據正常更新
   - 🟡 黃燈：正在更新中
   - 🔴 紅燈：更新發生錯誤

### OVB 拋售偵測使用技巧
1. **拋售強度解讀**:
   - 0-30%: 正常市場狀態
   - 30-50%: 輕微拋售壓力
   - 50-70%: 中等拋售壓力，需要關注
   - 70%+: 強烈拋售壓力，系統會自動警報

2. **OVB 與 EMA21 關係**:
   - OVB > EMA21: 買盤力量較強，偏向看漲
   - OVB < EMA21: 賣盤力量較強，偏向看跌
   - OVB ≈ EMA21: 趨勢相對平衡，觀察後續發展
   - OVB 與 EMA21 交叉: 可能出現趨勢轉換
   - 注意：剛開始時數據點較少，OVB ≈ EMA21 是正常現象

3. **綜合判斷**:
   - 結合買賣壓力比例和趨勢狀態
   - 觀察OVB值的變化趨勢
   - 配合價格技術分析使用效果更佳
   - 可點擊「重置」按鈕清除歷史數據重新開始計算

## 📞 支援與回饋

如果您遇到問題或有改進建議，請：
1. 檢查瀏覽器開發者工具的錯誤訊息
2. 確認網路連線正常
3. 嘗試使用 CORS 代理伺服器

## 📄 授權

本專案僅供學習和研究使用，請遵守相關 API 服務的使用條款。

---

**祝您交易順利！** 📈💰 