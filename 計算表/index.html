<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OKX æ§“æ¡¿ç²åˆ©è¨ˆç®—å·¥å…·</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- åŠ å¯†è²¨å¹£æœå°‹å½ˆçª— -->
  <div id="cryptoSearchModalOverlay">
    <div id="cryptoSearchModal">
      <h2>ğŸ” åŠ å¯†è²¨å¹£æœå°‹</h2>
      <input type="text" id="cryptoSearchInput" placeholder="æœå°‹å¹£ç¨®ï¼ˆå¦‚ BTCã€ETHã€OPï¼‰">

      <!-- æœå°‹çµæœ -->
      <div class="section-header">
        <h3>ğŸ” æœå°‹çµæœ</h3>
        <button class="btn-clear" onclick="clearSearchResult()">ğŸ—‘ ä¸€éµæ¸…é™¤</button>
      </div>
      <div id="searchResult" class="crypto-list"></div>

      <!-- æœ€è¿‘æœå°‹ -->
      <div class="section-header">
        <h3>ğŸ•˜ æœ€è¿‘æœå°‹</h3>
        <button class="btn-clear" onclick="clearCryptoHistory()">ğŸ—‘ ä¸€éµæ¸…é™¤</button>
      </div>
      <div class="crypto-list" id="recentSearchList"></div>

      <!-- æˆ‘çš„æœ€æ„› -->
      <div class="crypto-favorite">
        <h3>â­ æˆ‘çš„æœ€æ„›</h3>
        <div id="favoriteList"></div>
      </div>

      <div class="actions">
        <button onclick="closeCryptoSearch()">é—œé–‰</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="section yellow">
      <h2>é–‹å–®é€Ÿç®—è¡¨</h2>

      <label>é¸æ“‡å¹£ç¨®
        <div class="symbol-row">
          <input id="symbolInput" type="text" autocomplete="off" list="symbolList" />
          <datalist id="symbolList"></datalist>
          <button type="button" class="search-btn" onclick="openCryptoSearch()">ğŸ” æœå°‹</button>
          <button type="button" class="clear-btn" onclick="clearSymbolInput()">æ¸…é™¤</button>
        </div>
      </label>

      <label>æœ¬é‡‘ USDT
        <input id="capital" type="number" value="1658" oninput="calculate()"/>
      </label>

      <label>é¦–æ¬¡é–‹å€‰åƒ¹æ ¼
        <div class="price-row">
          <input id="entryPrice" type="number" step="0.00001" oninput="calculate()"/>
          <button id="togglePriceBtn" onclick="togglePriceMode()">ä½¿ç”¨é™åƒ¹</button>
        </div>
      </label>

      <!-- è³‡é‡‘è²»ç‡é¡¯ç¤ºå€ -->
      <div id="funding-rate-container" style="margin-top: 8px; font-weight: bold;">
        è³‡é‡‘è²»ç‡ï¼š<span id="funding-rate" style="color:gray;">è®€å–ä¸­...</span>
        <div id="funding-rate-long" style="margin-top: 4px; font-size: 14px;"></div>
        <div id="funding-rate-short" style="margin-top: 2px; font-size: 14px;"></div>
      </div>

      <label>ä¿è­‰é‡‘æ¯”ä¾‹ (%)
        <input id="marginRatio" type="number" value="5" oninput="calculate()"/>
      </label>

      <label>æ­¢ææ¯”ä¾‹ (%)
        <input id="stoploss" type="number" value="7.52" oninput="calculate()"/>
      </label>

      <label>æœ€å¤§è™§æ USDT
        <input id="maxLoss" type="number" value="300" oninput="calculate()"/>
      </label>

      <label>é–‹å€‰æ–¹å‘</label>
      <div class="position-radio-group">
        <label>
          <input type="radio" name="positionSide" value="é–‹å¤š" checked>
          ğŸ“ˆ é–‹å¤š
        </label>
        <label>
          <input type="radio" name="positionSide" value="é–‹ç©º">
          ğŸ“‰ é–‹ç©º
        </label>
      </div>

      <div class="results-grid">
        <div class="result-item">æ§“æ¡¿å€æ•¸ï¼š<span id="leverage"></span> å€</div>
        <div class="result-item">ç¸½æŒå€‰é‡ï¼š<span id="position"></span></div>
      </div>

      <!-- ä¿å­˜æ›¸ç±¤åŠŸèƒ½ -->
      <button id="saveBtn" onclick="saveBookmark()">ğŸ’¾ å„²å­˜æ›¸ç±¤</button>
    </div>
  </div>

  <!-- æ›¸ç±¤å´é‚Šæ¬„ -->
  <div id="historySidebar">
    <h3>ğŸ“– æ›¸ç±¤ç´€éŒ„</h3>
    <div class="bookmark-actions-header">
      <button onclick="clearAllBookmarks()" class="btn-clear">ğŸ—‘ æ¸…é™¤å…¨éƒ¨</button>
    </div>
    <div id="historyList"></div>
  </div>

  <!-- æ›¸ç±¤æŒ‰éˆ• -->
  <button id="toggleHistoryBtn" onclick="toggleBookmarkSidebar()">ğŸ“š æ›¸ç±¤</button>

  <script>
    // å…¨å±€è®Šæ•¸
    let useMarketPrice = true;
    let symbolData = [];
    let priceUpdateInterval;
    let fundingRateInterval;

    // åƒ¹æ ¼æ¨¡å¼åˆ‡æ›
    function togglePriceMode() {
      useMarketPrice = !useMarketPrice;
      const btn = document.getElementById('togglePriceBtn');
      btn.textContent = useMarketPrice ? 'ä½¿ç”¨é™åƒ¹' : 'ä½¿ç”¨å¸‚åƒ¹';
      
      if (useMarketPrice) {
        fetchMarketPrice();
        startPriceUpdates();
      } else {
        stopPriceUpdates();
      }
    }

    // å•Ÿå‹•å³æ™‚åƒ¹æ ¼æ›´æ–°
    function startPriceUpdates() {
      if (priceUpdateInterval) clearInterval(priceUpdateInterval);
      priceUpdateInterval = setInterval(() => {
        if (useMarketPrice) {
          fetchMarketPrice();
        }
      }, 3000); // æ¯3ç§’æ›´æ–°ä¸€æ¬¡
    }

    // åœæ­¢åƒ¹æ ¼æ›´æ–°
    function stopPriceUpdates() {
      if (priceUpdateInterval) {
        clearInterval(priceUpdateInterval);
        priceUpdateInterval = null;
      }
    }

    // è½‰æ›å‡½æ•¸
    function instIdToDisplay(id) {
      const p = id.split("-");
      return p[0] + p[1] + ".P";
    }

    function displayToInstId(d) {
      if (!d.endsWith(".P")) return d;
      const code = d.slice(0, -2);
      const base = code.slice(0, -4);
      const quote = code.slice(-4);
      return `${base}-${quote}-SWAP`;
    }

    // è¼‰å…¥å¹£ç¨®åˆ—è¡¨
    async function loadSymbols() {
      try {
        const res = await fetch("https://www.okx.com/api/v5/public/instruments?instType=SWAP");
        const data = await res.json();
        const dl = document.getElementById("symbolList");
        
        if (!dl) return;
        
        symbolData = data.data.filter(i => i.settleCcy === "USDT" && i.instId.endsWith("-SWAP"));
        
        symbolData.forEach(i => {
          const opt = document.createElement("option");
          opt.value = instIdToDisplay(i.instId);
          dl.append(opt);
        });
        
        // è¨­å®šé è¨­å€¼
        document.getElementById("symbolInput").value = instIdToDisplay("OP-USDT-SWAP");
        fetchMarketPrice();
        fetchFundingRate(document.getElementById("symbolInput").value);
        startPriceUpdates();
        startFundingRateUpdates();
      } catch (error) {
        console.error("è¼‰å…¥å¹£ç¨®å¤±æ•—ï¼š", error);
      }
    }

    // ç²å–å¸‚åƒ¹
    async function fetchMarketPrice() {
      try {
        const symbolValue = document.getElementById("symbolInput").value;
        if (!symbolValue) return;
        
        const inst = displayToInstId(symbolValue);
        const r = await fetch(`https://www.okx.com/api/v5/market/ticker?instId=${inst}`);
        const j = await r.json();
        const p = parseFloat(j.data?.[0]?.last);
        
        if (useMarketPrice && !isNaN(p)) {
          document.getElementById("entryPrice").value = p;
          calculate();
        }
      } catch (error) {
        console.error("ç²å–å¸‚åƒ¹å¤±æ•—ï¼š", error);
      }
    }

    // è³‡é‡‘è²»ç‡ç›¸é—œåŠŸèƒ½
    async function fetchFundingRate(symbol) {
      const instId = symbol.replace('USDT.P', '-USDT-SWAP');
      try {
        const response = await fetch(`https://www.okx.com/api/v5/public/funding-rate?instId=${instId}`);
        const data = await response.json();
        if (data?.data?.length > 0) {
          const rate = parseFloat(data.data[0].fundingRate);
          const ratePercent = +(rate * 100).toFixed(6);
          const percentText = ratePercent.toFixed(4) + '%';

          document.getElementById("funding-rate").textContent = percentText;
          document.getElementById("funding-rate").style.color = rate > 0 ? "green" : rate < 0 ? "red" : "gray";

          const longDiv = document.getElementById("funding-rate-long");
          const shortDiv = document.getElementById("funding-rate-short");
          const isBTC = symbol.startsWith("BTC");

          let longClass = '', longStrategy = '', longColor = '';
          let shortClass = '', shortStrategy = '', shortColor = '';

          if (isBTC) {
            if (ratePercent >= -0.01 && ratePercent <= 0.03) {
              longClass = 'âœ… æ­£å¸¸ï¼ˆå»ºè­°å¯äº¤æ˜“ï¼‰';
              longColor = 'green';
            } else if ((ratePercent > 0.03 && ratePercent <= 0.2) || (ratePercent < -0.01 && ratePercent >= -0.03)) {
              longClass = 'âš ï¸ éæ­£å¸¸ï¼ˆé«˜æˆæœ¬å€ï¼‰';
              longColor = 'orange';
            } else if ((ratePercent > 0.2 && ratePercent <= 0.375) || (ratePercent < -0.2 && ratePercent >= -0.375)) {
              longClass = 'â— ç‰¹æ®Šï¼ˆé«˜é¢¨éšªï¼Œå‹¿è¿½é«˜ï¼‰';
              longColor = 'red';
            } else {
              longClass = 'ğŸŸ¡ ä¸åœ¨å®šç¾©ç¯„åœ';
              longColor = 'gray';
            }
            shortClass = longClass;
            shortColor = longColor;
          } else {
            if (ratePercent >= -0.02 && ratePercent <= 0.06) {
              longClass = 'âœ… æ­£å¸¸ï¼ˆå»ºè­°å¯äº¤æ˜“ï¼‰';
              longColor = 'green';
            } else if ((ratePercent > 0.06 && ratePercent <= 0.4) || (ratePercent < -0.02 && ratePercent >= -0.4)) {
              longClass = 'âš ï¸ éæ­£å¸¸ï¼ˆé«˜æˆæœ¬å€ï¼‰';
              longColor = 'orange';
            } else if ((ratePercent > 0.4 && ratePercent <= 0.75) || (ratePercent < -0.4 && ratePercent >= -0.75)) {
              longClass = 'â— ç‰¹æ®Šï¼ˆé«˜é¢¨éšªï¼Œå‹¿è¿½é«˜ï¼‰';
              longColor = 'red';
            } else {
              longClass = 'ğŸŸ¡ ä¸åœ¨å®šç¾©ç¯„åœ';
              longColor = 'gray';
            }
            shortClass = longClass;
            shortColor = longColor;
          }

          if (rate > 0) {
            longStrategy = 'âš ï¸ ä½ éœ€ä»˜è²»ï¼ˆç©ºæ–¹å¸‚å ´åå¼·ï¼‰';
            shortStrategy = 'âœ… å¯æ”¶è²»ï¼ˆå¸‚å ´åç©ºï¼‰';
          } else if (rate < 0) {
            longStrategy = 'âœ… å¯æ”¶è²»ï¼ˆå¸‚å ´åå¤šï¼‰';
            shortStrategy = 'âš ï¸ ä½ éœ€ä»˜è²»ï¼ˆå¤šæ–¹å¸‚å ´åå¼·ï¼‰';
          } else {
            longStrategy = 'ğŸŸ¡ ä¸­æ€§ï¼ˆé›™æ–¹ç„¡è³‡é‡‘è²»ï¼‰';
            shortStrategy = 'ğŸŸ¡ ä¸­æ€§ï¼ˆé›™æ–¹ç„¡è³‡é‡‘è²»ï¼‰';
          }

          longDiv.innerHTML = `ğŸ’¡ åšå¤šï¼š<span style="color:${longColor}">${longClass}</span>ï½œ<span style="color:${longColor}">${longStrategy}</span>`;
          shortDiv.innerHTML = `ğŸ’¡ åšç©ºï¼š<span style="color:${shortColor}">${shortClass}</span>ï½œ<span style="color:${shortColor}">${shortStrategy}</span>`;

        } else {
          document.getElementById("funding-rate").textContent = "ç„¡è³‡æ–™";
          document.getElementById("funding-rate-long").textContent = "";
          document.getElementById("funding-rate-short").textContent = "";
        }
      } catch (err) {
        console.error("è³‡é‡‘è²»ç‡å–å¾—éŒ¯èª¤ï¼š", err);
        document.getElementById("funding-rate").textContent = "éŒ¯èª¤";
        document.getElementById("funding-rate-long").textContent = "";
        document.getElementById("funding-rate-short").textContent = "";
      }
    }

    // å•Ÿå‹•è³‡é‡‘è²»ç‡æ›´æ–°
    function startFundingRateUpdates() {
      if (fundingRateInterval) clearInterval(fundingRateInterval);
      fundingRateInterval = setInterval(() => {
        const symbolValue = document.getElementById("symbolInput").value;
        if (symbolValue && symbolValue.endsWith("USDT.P")) {
          fetchFundingRate(symbolValue);
        }
      }, 15000); // æ¯15ç§’æ›´æ–°ä¸€æ¬¡
    }

    // æ ¸å¿ƒè¨ˆç®—å‡½æ•¸
    function calculate() {
      const cap = +document.getElementById("capital").value;
      const mr = +document.getElementById("marginRatio").value / 100;
      const sr = +document.getElementById("stoploss").value / 100;
      const ml = +document.getElementById("maxLoss").value;
      const ep = +document.getElementById("entryPrice").value;

      if (!cap || !mr || !sr || !ml || !ep) return;

      const B3 = cap * mr;
      const B4 = ml / (B3 * sr);
      document.getElementById("leverage").textContent = Math.round(B4);

      const position = Math.round(B3 * B4);
      document.getElementById("position").textContent = `$${position.toLocaleString()} USDT`;


    }

         // æ›¸ç±¤åŠŸèƒ½
     function saveBookmark() {
       const symbol = document.getElementById("symbolInput").value;
       const capital = document.getElementById("capital").value;
       const entryPrice = document.getElementById("entryPrice").value;
       const marginRatio = document.getElementById("marginRatio").value;
       const stoploss = document.getElementById("stoploss").value;
       const maxLoss = document.getElementById("maxLoss").value;
       const positionSide = document.querySelector('input[name="positionSide"]:checked')?.value || "é–‹å¤š";

       if (!symbol || !capital || !entryPrice) {
         alert("è«‹å¡«å…¥å¿…è¦è³‡è¨Šï¼ˆå¹£ç¨®ã€æœ¬é‡‘ã€é–‹å€‰åƒ¹æ ¼ï¼‰");
         return;
       }

       const bookmark = {
         id: Date.now(),
         timestamp: new Date().toLocaleString('zh-TW'),
         symbol,
         capital: parseFloat(capital),
         entryPrice: parseFloat(entryPrice),
         marginRatio: parseFloat(marginRatio),
         stoploss: parseFloat(stoploss),
         maxLoss: parseFloat(maxLoss),
         positionSide
       };

       // è¨ˆç®—çµæœ
       const leverage = document.getElementById("leverage").textContent;
       const position = document.getElementById("position").textContent;

       bookmark.results = {
         leverage,
         position
       };

       // ä¿å­˜åˆ° localStorage
       let bookmarks = JSON.parse(localStorage.getItem("tradingBookmarks") || "[]");
       bookmarks.unshift(bookmark);
       bookmarks = bookmarks.slice(0, 50); // æœ€å¤šä¿å­˜50å€‹æ›¸ç±¤
       localStorage.setItem("tradingBookmarks", JSON.stringify(bookmarks));

       alert("ğŸ“š æ›¸ç±¤å·²ä¿å­˜ï¼");
       loadBookmarks();
     }

    // è¼‰å…¥æ›¸ç±¤
    function loadBookmarks() {
      const bookmarks = JSON.parse(localStorage.getItem("tradingBookmarks") || "[]");
      const listDiv = document.getElementById("historyList");
      listDiv.innerHTML = "";

      bookmarks.forEach(bookmark => {
        const div = document.createElement("div");
        div.className = "bookmark-card";
        div.innerHTML = `
          <div class="bookmark-info">
            <strong>${bookmark.symbol}</strong> - ${bookmark.positionSide}<br>
            æœ¬é‡‘: $${bookmark.capital} | åƒ¹æ ¼: $${bookmark.entryPrice}<br>
            æ§“æ¡¿: ${bookmark.results.leverage} | æŒå€‰: ${bookmark.results.position}<br>
            <small>${bookmark.timestamp}</small>
          </div>
          <div class="bookmark-actions">
            <button class="apply-btn" onclick="applyBookmark(${bookmark.id})">ğŸ“‹ å¥—ç”¨</button>
            <button class="delete-btn" onclick="deleteBookmark(${bookmark.id})">ğŸ—‘ åˆªé™¤</button>
          </div>
        `;
        listDiv.appendChild(div);
      });
    }

         // å¥—ç”¨æ›¸ç±¤
     function applyBookmark(id) {
       const bookmarks = JSON.parse(localStorage.getItem("tradingBookmarks") || "[]");
       const bookmark = bookmarks.find(b => b.id === id);
       
       if (!bookmark) return;

       document.getElementById("symbolInput").value = bookmark.symbol;
       document.getElementById("capital").value = bookmark.capital;
       document.getElementById("entryPrice").value = bookmark.entryPrice;
       document.getElementById("marginRatio").value = bookmark.marginRatio;
       document.getElementById("stoploss").value = bookmark.stoploss;
       document.getElementById("maxLoss").value = bookmark.maxLoss;

       // è¨­å®šé–‹å€‰æ–¹å‘
       const radioBtn = document.querySelector(`input[name="positionSide"][value="${bookmark.positionSide}"]`);
       if (radioBtn) radioBtn.checked = true;

       // é‡æ–°è¨ˆç®—å’Œç²å–è³‡æ–™
       calculate();
       fetchFundingRate(bookmark.symbol);
       if (useMarketPrice) {
         fetchMarketPrice();
       }

       alert("ğŸ“‹ æ›¸ç±¤åƒæ•¸å·²å¥—ç”¨ï¼");
     }

    // åˆªé™¤æ›¸ç±¤
    function deleteBookmark(id) {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹æ›¸ç±¤å—ï¼Ÿ")) return;
      
      let bookmarks = JSON.parse(localStorage.getItem("tradingBookmarks") || "[]");
      bookmarks = bookmarks.filter(b => b.id !== id);
      localStorage.setItem("tradingBookmarks", JSON.stringify(bookmarks));
      loadBookmarks();
    }

    // æ¸…é™¤æ‰€æœ‰æ›¸ç±¤
    function clearAllBookmarks() {
      if (!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ›¸ç±¤å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")) return;
      
      localStorage.removeItem("tradingBookmarks");
      loadBookmarks();
      alert("ğŸ—‘ æ‰€æœ‰æ›¸ç±¤å·²æ¸…é™¤ï¼");
    }

    // åˆ‡æ›æ›¸ç±¤å´é‚Šæ¬„
    function toggleBookmarkSidebar() {
      const sidebar = document.getElementById("historySidebar");
      if (sidebar.style.right === "0px") {
        sidebar.style.right = "-350px";
      } else {
        sidebar.style.right = "0px";
        loadBookmarks();
      }
    }

    

    // æœå°‹ç›¸é—œåŠŸèƒ½
    function openCryptoSearch() {
      document.getElementById("cryptoSearchModalOverlay").style.display = "flex";
      loadRecentSearches();
      loadFavorites();
    }

    function closeCryptoSearch() {
      document.getElementById("cryptoSearchModalOverlay").style.display = "none";
    }

    function clearSymbolInput() {
      document.getElementById('symbolInput').value = '';
      calculate();
    }

    function clearSearchResult() {
      document.getElementById("searchResult").innerHTML = "";
    }

    function clearCryptoHistory() {
      localStorage.removeItem("cryptoHistory");
      document.getElementById("recentSearchList").innerHTML = "";
    }

    function searchCrypto() {
      const query = document.getElementById("cryptoSearchInput").value.toUpperCase();
      const resultDiv = document.getElementById("searchResult");
      
      if (!query) {
        resultDiv.innerHTML = "";
        return;
      }

      const filtered = symbolData.filter(item => {
        const display = instIdToDisplay(item.instId);
        return display.includes(query);
      }).slice(0, 20);

      resultDiv.innerHTML = "";
      filtered.forEach(item => {
        const display = instIdToDisplay(item.instId);
        const div = document.createElement("div");
        div.className = "crypto-item";
        div.innerHTML = `
          <span onclick="selectCrypto('${display}')">${display}</span>
          <button onclick="toggleFavorite('${display}')">â­</button>
        `;
        resultDiv.appendChild(div);
      });
    }

    function selectCrypto(symbol) {
      document.getElementById("symbolInput").value = symbol;
      saveToHistory(symbol);
      fetchMarketPrice();
      fetchFundingRate(symbol);
      closeCryptoSearch();
      calculate();
    }

    function saveToHistory(symbol) {
      let history = JSON.parse(localStorage.getItem("cryptoHistory") || "[]");
      history = history.filter(item => item !== symbol);
      history.unshift(symbol);
      history = history.slice(0, 10);
      localStorage.setItem("cryptoHistory", JSON.stringify(history));
    }

    function loadRecentSearches() {
      const history = JSON.parse(localStorage.getItem("cryptoHistory") || "[]");
      const listDiv = document.getElementById("recentSearchList");
      listDiv.innerHTML = "";
      
      history.forEach(symbol => {
        const div = document.createElement("div");
        div.className = "crypto-item";
        div.innerHTML = `<span onclick="selectCrypto('${symbol}')">${symbol}</span>`;
        listDiv.appendChild(div);
      });
    }

    function toggleFavorite(symbol) {
      let favorites = JSON.parse(localStorage.getItem("cryptoFavorites") || "[]");
      if (favorites.includes(symbol)) {
        favorites = favorites.filter(item => item !== symbol);
      } else {
        favorites.push(symbol);
      }
      localStorage.setItem("cryptoFavorites", JSON.stringify(favorites));
      loadFavorites();
    }

    function loadFavorites() {
      const favorites = JSON.parse(localStorage.getItem("cryptoFavorites") || "[]");
      const listDiv = document.getElementById("favoriteList");
      listDiv.innerHTML = "";
      
      favorites.forEach(symbol => {
        const div = document.createElement("div");
        div.className = "favorite-item";
        div.innerHTML = `
          <span class="coin-name" onclick="selectCrypto('${symbol}')">${symbol}</span>
          <button class="remove" onclick="toggleFavorite('${symbol}')">Ã—</button>
        `;
        listDiv.appendChild(div);
      });
    }

    // ç›£è½ç¬¦è™Ÿè¼¸å…¥è®ŠåŒ–
    document.getElementById("symbolInput").addEventListener("input", () => {
      const symbolValue = document.getElementById("symbolInput").value;
      if (useMarketPrice) {
        fetchMarketPrice();
      }
      if (symbolValue && symbolValue.endsWith("USDT.P")) {
        fetchFundingRate(symbolValue);
      }
    });

    // ç›£è½æœå°‹è¼¸å…¥
    document.getElementById("cryptoSearchInput").addEventListener("input", searchCrypto);

    // é»æ“Šé®ç½©é—œé–‰å½ˆçª—
    document.getElementById("cryptoSearchModalOverlay").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) {
        closeCryptoSearch();
      }
    });

    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener("DOMContentLoaded", () => {
      loadSymbols();
      calculate();
      loadBookmarks();
    });

    // é é¢å¸è¼‰æ™‚æ¸…ç†å®šæ™‚å™¨
    window.addEventListener("beforeunload", () => {
      stopPriceUpdates();
      if (fundingRateInterval) clearInterval(fundingRateInterval);
    });
  </script>

  <footer style="text-align:center; padding: 16px; font-size: 14px; color: gray;">
    æ´ªå£«å¼˜ ç‰ˆæ¬Šæ‰€æœ‰ Â©2025 å¤§ä»è€å¸«æŠ•è³‡ç†è²¡å­¸å ‚å°ˆå±¬å·¥å…·
  </footer>
</body>
</html>
